<!DOCTYPE html>
<html>
<title>Toulouse Hacking Convention</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
<style>
body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif}
body {font-size:16px;}
.w3-half img{margin-bottom:-6px;margin-top:16px;opacity:0.8;cursor:pointer}
.w3-half img:hover{opacity:1}
.box {
  background-color: grey;
  color: white;
  padding: 10px;
  margin-right: 30px;
  margin-left: 30px;
  border-radius: 10px;
}
.clear
{
clear: both;
}
.code{
  margin-left:30px;
  margin-right:30px;
}
img {
    max-width: 100%;
    max-height: 100%;
}
</style>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
<script type="text/javascript">
	flag = true;
	function fonc1(){
		var test = document.getElementById("answer").value;
		var node = document.getElementById("bravo");
		if(test>=195 && test<=205){
			node.textContent = "Félicitations, c'est la bonne réponse !";
      document.getElementById("encod").style.display = "";
			flag = false;
		}
		else {
			if(flag) {
				node.textContent = "Try again";
			}
		}
	}
	function runScriptFonc1(e) {
	    if (e.keyCode == 13) {
	        fonc1();
	    }
	}
  function runScriptFonc6(e) {
	    if (e.keyCode == 13) {
	        fonc6();
	    }
	}
  function fonc2() {
    document.getElementById("multichannel").style.display = "";
  }
  function fonc3() {
    document.getElementById("movntdq").style.display = "";
  }
  function fonc4() {
    document.getElementById("sumup").style.display = "";
  }
  function fonc5() {
    if(document.getElementById("b").checked == true) {
      document.getElementById("question").textContent = "Bonne réponse ! Nous allons en effet devoir écrire des instructions en langage assembleur et le C est tout indiqué pour cela.";
      document.getElementById("asm").style.display = "";
    } else if (document.getElementById("d").checked == true) {
      document.getElementById("question").textContent = "Mince... Tournez-vous vers l'encadrant pour faire le point avec lui.";
    } else {
      document.getElementById("question").textContent = "Mauvaise réponse...";
    }
  }
  function fonc6() {
    if(document.getElementById("asm-input").value.toLowerCase() == "movntdq") {
      document.getElementById("asm-answer").textContent = "Bonne réponse ! En effet, cette dernière instruction assembleur a pour effet d'écrire, via le bus de données, les 128 bits de données présents dans le registre xmm0 vers un buffer en mémoire.";
    } else {
      document.getElementById("asm-answer").textContent = "Mauvaise réponse... Il fallait écrire l'instruction MOVNTDQ. En effet, cette dernière instruction assembleur a pour effet d'écrire, via le bus de données, les 128 bits de données présents dans le registre xmm0 vers un buffer en mémoire. ";
    }
    document.getElementById("meo").style.display = "";
  }

  function fonc7() {
    if (document.getElementById("sig-d").checked == true) {
      document.getElementById("sig-answer").textContent = "Bonne réponse, vous avez compris la modultion ASK !";
      document.getElementById("fin").style.display = "";
      document.getElementById("bouton").disabled = false;
    } else {
      document.getElementById("sig-answer").textContent = "Try again...";
    }

  }
</script>
<body>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-red w3-collapse w3-top w3-large w3-padding" style="z-index:3;width:300px;font-weight:bold;" id="mySidebar"><br>
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-button w3-hide-large w3-display-topleft" style="width:100%;font-size:22px">Close Menu</a>
  <div class="w3-container">
    <a href="index.html" style="text-decoration: none"><h3 class="w3-padding-64"><b>Toulouse<br>Hacking<br>Convention</b></h3></a>
  </div>
  <div class="w3-bar-block">
    <a href="intro.html" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Introduction</a>
    <a href="etape1.html" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Étape 1</a>
    <a onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Étape 2</a>
    <br>
  </div>
  <div class="w3-bar-block">
    <a href="credit.html" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Crédits</a>
  </div>
</nav>

<!-- Top menu on small screens -->
<header class="w3-container w3-top w3-hide-large w3-red w3-xlarge w3-padding">
  <a href="javascript:void(0)" class="w3-button w3-red w3-margin-right" onclick="w3_open()">☰</a>
  <span>Toulouse Hacking Convention</span>
</header>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:340px;margin-right:40px">

  <!-- Header -->
  <div class="w3-container" style="margin-top:80px; text-align: justify;" id="showcase">
    <h1 class="w3-xxxlarge"><b>Wanna TEMPEST your computer?</b></h1>
    <h1 class="w3-xxlarge w3-text-red"><b>Étape 2</b></h1>
    <hr style="width:50px;border:5px solid red" class="w3-round">
  <div>
    <p>Nous avons pu observer à l'étape 1 que certaines activités sur l'ordinateur provoquaient une variation significative du spectre.</p>
    <p>L'idée que nous allons maintenant développer jusqu'à la fin du challenge est la suivante : comme nous pouvons provoquer et contrôler une activité électromagnétique sur l'ordinateur et que celle-ci peut être observée par l'intermédiaire d'un récepteur, il nous est alors possible de créer un signal dans lequel seront codées certaines informations que nous souhaitons extraire de l'ordinateur.</p>
    <p>Avant toute chose, nous devons trouver une activité émettant une onde électromagnétique de façon significative. C'est pour cette raison que nous allons décrire les architectures mémoire à multiples canaux.</p>
    <p><input type="button" value="Je veux en savoir plus sur la mémoire à multiples canaux" onclick=fonc2()></p>
  </div>

  <div id="multichannel" style="display: none;">
    <h1 class="w3-xlarge"><b>Architecture mémoire à multiples canaux</b></h1>
    <div>
      <table>
        <tr>
          <td width="30%" style="padding-right:10px"><img src="images/motherboard.png"/><br>Architecture d'une carte mère <br>(source Wikipedia)</td>
          <td width="70%"><div>
            <p>Le contrôleur de mémoire (encore appelé <i>Northbridge</i>) est un composant de la carte mère relié au microprocesseur. Il est notamment en charge de fournir au CPU les données présentes en mémoire (RAM).</p>
            <p>La transmission de ces données entre la RAM et le contrôleur mémoire se fait par l'intermédiaire du bus de données qui a généralement une taille de 64 bits sur les ordinateurs actuels. Cela signifie que 64 bits de données peuvent être transférés entre le contrôleur mémoire et la RAM en un seul coup d'horloge du processeur.</p>
            <p>Comme la taille de ce bus détermine en partie les vitesse d'entrée/sortie en RAM, les constructeurs de microprocesseurs (AMD et Intel) ont cherché à améliorer les performances de ce système. </p>
          </div></td>
        </tr>
      </table>
    </div>

    <div>
      <table>
        <tr>
          <td width="40%"><div>
            <p>Dans cette perspective d'amélioration des performances, l'idée a été d'utiliser deux barrettes de RAM identiques pour agrandir le bus mémoire. Comme on peut le voir sur la figure ci-contre, ce mécanisme permet ainsi d'obtenir un bus de données de 128 bits.</p>
            <p>Les constructeurs ont étendu ce principe à trois et quatre canaux, permettant d'obtenir des bus de données d'une taille respective de 192 et 256 bits.</p>
            <p>Aujourd'hui, la plupart des ordinateurs sont compatibles avec les architectures à multiples canaux.</p>
            <p>On peut déjà voir que ce type de mécanisme, même s'il augmente la vitesse d'entrée/sortie en mémoire, est gourmand en énergie. En effet, il mobilise à chaque coup d'horloge presque deux fois plus de ressources matérielles que dans le cas d'un simple canal. On sait maintenant que cela pourra potentiellement avoir des conséquences sur les émissions électromagnétiques de l'ordinateur.</p>
            <p>Si vous avez compris les architectures à multiples canaux, voyons maintenant comment le processeur peut directement mettre en œuvre le mécanisme.</p>
          </div></td>
          <td width="30%" style="padding-left:10px"><img src="images/mono-canal.png" /><br>Architecture mono-canal</td>
          <td width="30%"><img src="images/multi-canal.png"/><br>Architecture multi-canal</td>
        </tr>
      </table>
    </div>

    <div>
      <p><input type="button" value="J'ai compris la mémoire à multiples canaux" onclick=fonc3()></p>
    </div>
  </div>

  <div id="movntdq" style="display: none;">
    <h1 class="w3-xlarge"><b>L'instruction MOVNTDQ</b></h1>
    <p>Du fait des mécanismes de cache et d'optimisation mis en place par le processeur, on ne peut être certain qu'une activité aura toujours lieu sur le bus de données. Or une telle activité est nécessaire pour potentiellement obtenir l'émission d'une onde électromagnétique significative.</p>
    <p>Heureusement, il existe des instructions liées aux processeurs modernes permettant d'activer une lecture/écriture directement depuis/vers la RAM et ce sans utiliser les mécanismes de cache. C'est par exemple le cas de l'instruction <b>MOVNTDQ <i>m128,xmm</i></b> dont le but est de directement déplacer 128 bits de données présentes dans un registre <i>xmm</i> vers une zone mémoire spécifiée.</p>
    <p>Au delà de la non utilisation des caches, cette instruction tirera avantage de l'existence de multiples canaux afin d'effectuer l'opération en un seul coup d'horloge : un double canal présent sur la machine sera donc entièrement utilisé pour déplacer ces 128 bits de données vers la RAM en un unique coup d'horloge.</p>
    <p><input type="button" value="J'ai compris MOVNTDQ" onclick=fonc4()></p>
  </div>

  <div class="box" id="sumup" style="display: none;">
    <h1 class="w3-xlarge w3-text"><b>Résumons un peu...</b></h1>
    <p>Nous venons de voir deux choses importantes :</p>
    <ol>
      <li>Les architectures à multiples canaux génèrent potentiellement des émissions électromagnétiques significatives</li>
      <li>L'instruction <b>MOVNTDQ</b> du processeur permet de mettre en œuvre une activité sur le bus de données en utilisant les canaux multiples</li>
    </ol>
    <p>Que pouvons nous faire maintenant pour vérifier ces deux points?</p>
    <input type="radio" name="choix" id="a" autocomplete="off"> Rien </input><br>
    <input type="radio" name="choix" id="b" autocomplete="off"> Réaliser un programme en C qui écrit des données en mémoire et voir avec l'analyseur de spectre si une émission significative a lieu</input><br>
    <input type="radio" name="choix" id="c" autocomplete="off"> Réaliser un programme Python qui écrit des données en mémoire et voir avec l'analyseur de spectre si une émission significative a lieu</input><br>
    <input type="radio" name="choix" id="d" autocomplete="off"> Chercher plus d'informations sur Internet parce qu'on ne comprend pas où les créateurs du challenge veulent en venir </input><br>
    <input type="button" value="Valider" onclick="fonc5()">
    <p id="question"></p>
  </div>

  <div id="asm" style="display: none;">
    <div>
      <p>L'idée maintenant est d'utiliser les fonctions assembleur du langage C pour mettre en œuvre une écriture en mémoire.</p>
      <p>Voici le code C de la fonction mettant en œuvre certaines instructions assembleur. Complétez l'instruction manquante :</p>
    </div>
    <div class="code">
      <pre class="prettyprint">
  void mov_data(int * data_ptr,char * buffer_ptr )
  {
    __asm("movq %0,%%xmm0\n"  //Écriture dans xmm0 de 64 bits de données
           :
           :"m" (*data_ptr)
           :"%xmm0");
    __asm("movq %0,%%xmm1\n"  //Écriture dans xmm1 de 64 bits de données
           :
           :"m" (*(data_ptr+8))
           :"%xmm1");
    __asm("movlhps %xmm1,%xmm0\n");  //128 bits de données dans xmm0
    __asm("<input type="text" id="asm-input" value="" onkeypress=runScriptFonc6(event) autocomplete="off"> %%xmm0,%0\n" : "=m"(*buffer_ptr));
  }
      </pre>
      <div>
        <input type="button" value="Valider" onclick="fonc6()">
        <p id="asm-answer"></p>
      </div>
    </div>
  </div>

  <div id="meo" style="display: none;">
    <h1 class="w3-xlarge w3-text"><b>Mise en œuvre</b></h1>
    <p>Maintenant que nous avons une fonction réalisant une activité sur le bus de données, vérifions que celle-ci provoque des émissions électromagnétiques significatives. Il faudra pour cela parcourir le spectre de fréquences grâce à la fonction analyseur de spectre d'URH.</p>

    <div class="box">
      <h1 class="w3-xlarge w3-text"><b>Indication</b></h1>
        <p>Positionnez l'antenne du récepteur à proximité du PC. Parcourez le spectre entre 100MHz et 400MHz. En effet, si une émissions électromagnétique peut être observée, la fréquence de celle-ci se situera aux alentours de la fréquence d'entrée/sortie du bus de données.</p>
        <p>La fréquence des barrettes de RAM étant de 400MHz, les écritures en mémoire ne pourront donc pas se faire à une fréquence supérieure.</p>
    </div>

    <p>Lancez le programme <i>mov_data1.c</i> sur le PC attaqué. Ce programme réalise successivement les opérations suivantes :
      <ul>
        <li>Écriture de données en RAM pendant une période d'une seconde;</li>
        <li>Aucune activité pendant une période d'une seconde.</li>
      </ul>
    </p>
    <p>Ainsi, nous devrions observer en alternance une activité et une non-activité à une certaine fréquence.</p>
    <div class="box">
      <h1 class="w3-xlarge w3-text"><b>À vous !</b></h1>
      <p>À quelle fréquence le signal est-il émis ?</p>
      <input id="answer" type="number" step="0.01" name="answer" autocomplete="off" value="" onkeypress=runScriptFonc1(event)>
      <input type="button" value="Valider" onclick=fonc1()>
      <p id="bravo"></p>
	 </div>
  </div>


  <div id="encod" style="display: none;">
    <h1 class="w3-xlarge w3-text"><b>Encodage de l'information</b></h1>
    <p>Nous venons de voir que nous observons une émission électromagnétique autour de 200MHz. Des mesures plus précises nous permettent de savoir que la plus grande amplitude est obtenue à exactement <b>201,1MHz</b>.</p>
    <p>En enregistrant le signal, toujours avec URH, nous obtenons la représentation temporelle suivante :</p>
    <div>
      <img src="images/signal.png"/>
    </div>
    <p>On remarque de façon évidente les variations régulières d'amplitude qui correspondent aux variations d'activité sur le bus de données que nous avons créées.</p>
    <p>L'idée est alors d'utiliser ces variations pour coder de l'information : c'est ce qu'on appelle l'étape de <b>modulation</b>.</p>
    <p>La technique de modulation que nous allons utiliser ici sera <i>Amplitude-shift keying</i> (ASK). L'idée ici est d'utiliser les variations d'amplitude d'une onde porteuse pour coder de l'information. Comme nous souhaitons coder une information numérique et la transmettre bit par bit, seuls deux niveaux d'amplitude sont nécessaires : une amplitude haute correspondra à un 1 binaire et une amplitude basse correspondra à un 0 binaire. On parle alors de modulation <i>Binary-ASK</i> (B-ASK) ou encore de <i>On-off keying</i> (OOK).</p>
    <p>Ainsi, dans le cadre des émissions que nous contrôlons, il suffira de transmettre de l'information pendant une période <b>T</b> sur le bus de données pour obtenir une amplitude haute et coder un 1. Aucune transmission d'information pendant une période <b>T</b> nous permettra d'obtenir une fréquence basse et de coder un 0.</p>
    <div class="box">
      <h1 class="w3-xlarge w3-text"><b>Can I ASK you a question?</b></h1>
      <p>La lettre <b>a</b> dans la table ASCII est représentée en binaire par <b>01100001</b>. Selon la règle de modulation ASK telle que nous l'avons décrite ci-dessus, quel signal ci-dessous correspond à l'envoi de la lettre <b>a</b>?</p>
      <table style="">
        <tr>
          <td bgcolor="white"><img src="images/sig1.png"><br><input type="radio" name="rad-sig" id="sig-a"><font color="black"> a</font></td>
          <td bgcolor="white"><img src="images/sig4.png"><br><input type="radio" name="rad-sig" id="sig-b"><font color="black"> b</font></td>
        </tr>
        <tr>
          <td bgcolor="white"><img src="images/sig3.png"><br><input type="radio" name="rad-sig" id="sig-c"><font color="black"> c</font></td>
          <td bgcolor="white"><img src="images/sig2.png"><br><input type="radio" name="rad-sig" id="sig-d"><font color="black"> d</font></td>
        </tr>
      </table>
      <input type="button" value="Valider" onclick=fonc7()>
      <p id="sig-answer"></p>
    </div>
  </div>

  <div id="fin" style="display: none;">
    <p>On sait maintenant comment créer un canal caché pour exfiltrer de l'information d'un ordinateur. Voyons maintenant comment réceptionner le signal sur une autre machine.</p>
  </div>

  <div>
    <p><a href="etape3.html"><button id="bouton" class="w3-button w3-red" disabled>Passer à l'étape 3</button></a></p>
  </div>

<!-- End page content -->
</div>

<!-- W3.CSS Container -->
<div class="w3-light-grey w3-container w3-padding-32" style="margin-top:75px;padding-right:58px"></div>

<script>
// Script to open and close sidebar
function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
    document.getElementById("myOverlay").style.display = "block";
}

function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
}

// Modal Image Gallery
function onClick(element) {
  document.getElementById("img01").src = element.src;
  document.getElementById("modal01").style.display = "block";
  var captionText = document.getElementById("caption");
  captionText.innerHTML = element.alt;
}
</script>

</body>
</html>
